# KeyForge 简化版本使用说明

## 项目概述

这是一个真正简化的按键脚本工具，基于以下要求实现：
- 使用 .NET 8.0 + Windows Forms
- 彻底移除DDD复杂概念
- 采用最简单的架构：一个主窗体类 + 几个辅助类
- 核心功能：录制按键、回放脚本、保存/加载文件

## 项目结构

```
KeyForge-Simplified.sln    # 简化的解决方案文件
KeyForge.UI/
├── KeyForge.UI.csproj    # 项目配置文件
├── Program.cs           # 程序入口点
├── MainForm.cs          # 主窗体（简化实现）
├── KeyForgeApp.cs       # 主应用类（简化实现）
├── KeyAction.cs         # 按键动作模型（简化实现）
└── ScriptManager.cs     # 脚本管理类（简化实现）
```

## 核心类说明

### 1. KeyAction - 按键动作模型
- **原本实现**：复杂的领域模型和值对象
- **简化实现**：简单的POCO类，只包含必要属性
- **功能**：存储按键信息、状态和时间戳

### 2. ScriptManager - 脚本管理
- **原本实现**：复杂的仓储模式、UnitOfWork模式
- **简化实现**：直接使用JSON文件操作，简单直接
- **功能**：录制、播放、保存、加载脚本

### 3. KeyForgeApp - 主应用类
- **原本实现**：复杂的应用服务、命令处理、事件总线等
- **简化实现**：直接使用Windows API进行按键录制和模拟
- **功能**：管理录制和播放的核心逻辑

### 4. MainForm - 主窗体
- **原本实现**：复杂的窗体继承、依赖注入、大量事件处理
- **简化实现**：直接使用简化后的KeyForgeApp，简单的UI布局
- **功能**：提供用户界面

## 主要功能

### 录制功能
- 点击"开始录制"按钮开始录制按键
- 按下任意按键都会被记录
- 点击"停止录制"按钮停止录制
- 快捷键：F6（开始/停止录制）

### 播放功能
- 点击"播放"按钮播放录制的脚本
- 脚本会按照录制时的时序精确播放
- 点击"停止"按钮停止播放
- 快捷键：F7（播放）、F8（停止）

### 文件操作
- **保存脚本**：将录制的脚本保存为JSON文件
- **加载脚本**：从JSON文件加载脚本
- **清空**：清除当前录制的所有动作
- 快捷键：Ctrl+S（保存）、Ctrl+O（加载）

### 界面特性
- 实时显示录制和播放状态
- 显示按键动作列表
- 显示执行日志
- 显示脚本统计信息

## 技术特点

### 简化架构
- 移除了所有DDD概念
- 移除了复杂的依赖注入
- 移除了仓储模式和UnitOfWork
- 移除了事件总线和命令处理

### 直接实现
- 使用Windows API直接进行按键录制和模拟
- 使用System.Text.Json进行序列化
- 使用简单的文件操作
- 最小化依赖

### 性能优化
- 使用Timer进行定期状态检查
- 异步播放脚本避免阻塞UI
- 简化的数据结构提高处理速度

## 编译和运行

### 编译
```bash
dotnet build KeyForge-Simplified.sln --configuration Release
```

### 运行
```bash
dotnet run --project KeyForge.UI --configuration Release
```

或者直接运行生成的exe文件：
```
KeyForge.UI\bin\Release\net8.0-windows\KeyForge.exe
```

## 使用场景

这个简化版本适合以下场景：
- 游戏按键宏录制
- 办公自动化
- 软件测试自动化
- 重复性操作自动化

## 注意事项

1. **管理员权限**：某些按键可能需要管理员权限才能正常录制和模拟
2. **游戏兼容性**：某些游戏可能检测到按键模拟，建议在测试环境中使用
3. **时序精度**：由于系统限制，时序精度可能在10-50ms之间
4. **按键冲突**：避免录制系统快捷键，可能导致意外行为

## 扩展建议

如果需要进一步扩展功能，可以考虑：
1. 添加循环播放功能
2. 添加脚本编辑功能
3. 添加多脚本管理
4. 添加热键绑定功能
5. 添加执行速度调节

## 故障排除

如果遇到问题，请检查：
1. 是否有足够的权限
2. 是否有其他程序占用按键
3. 脚本文件是否正确
4. 系统是否支持所需的API调用