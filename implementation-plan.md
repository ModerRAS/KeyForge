# KeyForge æ”¹è¿›å®æ–½è®¡åˆ’

## ğŸ“‹ **æ‰§è¡Œæ‘˜è¦**

åŸºäºspec-validatorçš„85/100åˆ†è¯„ä¼°ç»“æœï¼Œæœ¬å®æ–½è®¡åˆ’é’ˆå¯¹KeyForgeç®€åŒ–ç‰ˆæœ¬çš„å…³é”®é—®é¢˜æä¾›å…·ä½“çš„æ”¹è¿›æ–¹æ¡ˆã€‚é€šè¿‡åˆ†é˜¶æ®µå®æ–½ï¼Œå°†ä»£ç è´¨é‡æå‡è‡³95åˆ†ä»¥ä¸Šï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿçš„ç®€æ´æ€§å’Œå¯ç”¨æ€§ã€‚

## ğŸ¯ **æ ¸å¿ƒé—®é¢˜ä¸æ”¹è¿›æ–¹æ¡ˆ**

### 1. **é¡¹ç›®ç»“æ„æ··ä¹±** (99ä¸ªå†—ä½™æ–‡ä»¶)
**é—®é¢˜**ï¼šå­˜åœ¨å¤§é‡æœªä½¿ç”¨çš„DDDç›¸å…³æ–‡ä»¶ï¼Œé€ æˆé¡¹ç›®ç»“æ„æ··ä¹±
**æ”¹è¿›æ–¹æ¡ˆ**ï¼šæ¸…ç†å†—ä½™æ–‡ä»¶ï¼Œä¿ç•™æ ¸å¿ƒä¸‰å±‚æ¶æ„
**é¢„æœŸæ•ˆæœ**ï¼šé¡¹ç›®æ–‡ä»¶æ•°é‡å‡å°‘50%ä»¥ä¸Šï¼Œç¼–è¯‘æ—¶é—´ç¼©çŸ­30%

### 2. **æ€§èƒ½ç“¶é¢ˆ** (Timerè½®è¯¢)
**é—®é¢˜**ï¼šä½¿ç”¨10msé—´éš”çš„Timerè½®è¯¢æ£€æŸ¥æŒ‰é”®çŠ¶æ€ï¼ŒCPUå ç”¨ç‡é«˜
**æ”¹è¿›æ–¹æ¡ˆ**ï¼šæ›¿æ¢ä¸ºWindowsé’©å­æœºåˆ¶ (SetWindowsHookEx)
**é¢„æœŸæ•ˆæœ**ï¼šCPUå ç”¨ç‡é™ä½80%ï¼Œå“åº”å»¶è¿Ÿ<1ms

### 3. **æ¶æ„è¿‡åº¦ç®€åŒ–**
**é—®é¢˜**ï¼šç¼ºå°‘å¿…è¦æŠ½è±¡å±‚ï¼ŒèŒè´£è¿‡äºé›†ä¸­
**æ”¹è¿›æ–¹æ¡ˆ**ï¼šå¼•å…¥é€‚å½“æŠ½è±¡å±‚ï¼Œå®ç°ä¾èµ–æ³¨å…¥
**é¢„æœŸæ•ˆæœ**ï¼šä»£ç å¯æ‰©å±•æ€§æå‡ï¼Œç»´æŠ¤æˆæœ¬é™ä½

### 4. **é”™è¯¯å¤„ç†ä¸å®Œæ•´**
**é—®é¢˜**ï¼šErrorHandlerManagerå­˜åœ¨ä½†æœªé›†æˆ
**æ”¹è¿›æ–¹æ¡ˆ**ï¼šé›†æˆé”™è¯¯å¤„ç†åˆ°æ ¸å¿ƒæœåŠ¡ï¼Œå®ç°å®Œæ•´æ¢å¤ç­–ç•¥
**é¢„æœŸæ•ˆæœ**ï¼šç³»ç»Ÿç¨³å®šæ€§æå‡ï¼Œé”™è¯¯æ¢å¤æˆåŠŸç‡>95%

### 5. **èµ„æºç®¡ç†ç¼ºé™·**
**é—®é¢˜**ï¼šTimerå’ŒHookç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å®Œå–„
**æ”¹è¿›æ–¹æ¡ˆ**ï¼šå®Œå–„IDisposableæ¨¡å¼ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
**é¢„æœŸæ•ˆæœ**ï¼šå†…å­˜å ç”¨ç¨³å®šï¼Œæ— æŒç»­å¢é•¿

## ğŸ“Š **åˆ†é˜¶æ®µå®æ–½è®¡åˆ’**

### **ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®ç»“æ„æ¸…ç† (1å‘¨)**

#### **Day 1-2: åˆ†æå’Œè§„åˆ’**
**ç›®æ ‡**ï¼šåˆ†æç°æœ‰æ–‡ä»¶ç»“æ„ï¼Œåˆ¶å®šæ¸…ç†è®¡åˆ’

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| åˆ†æç°æœ‰æ–‡ä»¶ç»“æ„ | é«˜ | å¼€å‘è€… | 4å°æ—¶ | æ–‡ä»¶åˆ†ææŠ¥å‘Š |
| è¯†åˆ«å†—ä½™æ–‡ä»¶ | é«˜ | å¼€å‘è€… | 4å°æ—¶ | å†—ä½™æ–‡ä»¶æ¸…å• |
| åˆ¶å®šæ¸…ç†è®¡åˆ’ | é«˜ | å¼€å‘è€… | 2å°æ—¶ | æ¸…ç†è®¡åˆ’æ–‡æ¡£ |

**å…·ä½“å®æ–½æ­¥éª¤ï¼š**
1. æ‰«ææ‰€æœ‰é¡¹ç›®æ–‡ä»¶ï¼Œè¯†åˆ«ç©ºæ–‡ä»¶å’Œé‡å¤æ–‡ä»¶
2. åˆ†ææ–‡ä»¶ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å®‰å…¨åˆ é™¤
3. åˆ¶å®šåˆ†æ‰¹æ¸…ç†è®¡åˆ’ï¼Œé™ä½é£é™©

#### **Day 3-5: æ‰§è¡Œæ¸…ç†**
**ç›®æ ‡**ï¼šæ¸…ç†å†—ä½™æ–‡ä»¶ï¼Œä¼˜åŒ–é¡¹ç›®ç»“æ„

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| åˆ é™¤ç©ºDomainæ–‡ä»¶ | é«˜ | å¼€å‘è€… | 4å°æ—¶ | æ¸…ç†åçš„Domainå±‚ |
| åˆ é™¤ç©ºApplicationæ–‡ä»¶ | é«˜ | å¼€å‘è€… | 4å°æ—¶ | æ¸…ç†åçš„Applicationå±‚ |
| åˆ é™¤é‡å¤æµ‹è¯•æ–‡ä»¶ | é«˜ | å¼€å‘è€… | 4å°æ—¶ | æ¸…ç†åçš„æµ‹è¯•ç»“æ„ |
| éªŒè¯ç¼–è¯‘é€šè¿‡ | é«˜ | å¼€å‘è€… | 2å°æ—¶ | ç¼–è¯‘éªŒè¯æŠ¥å‘Š |

**åˆ é™¤æ–‡ä»¶æ¸…å•ï¼š**
```
# åˆ é™¤çš„æ–‡ä»¶ç±»å‹
- KeyForge.Domain/Class1.cs
- KeyForge.Application/Class1.cs
- KeyForge.Core/Class1.cs
- KeyForge.Infrastructure/Class1.cs
- æ‰€æœ‰ç©ºçš„DDDç›¸å…³æ–‡ä»¶
- é‡å¤çš„æµ‹è¯•æ–‡ä»¶
- æœªä½¿ç”¨çš„æ¥å£å®šä¹‰
```

**ä¿ç•™çš„æ ¸å¿ƒç»“æ„ï¼š**
```
KeyForge/
â”œâ”€â”€ KeyForge.Core/           # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ KeyForge.UI/             # ç”¨æˆ·ç•Œé¢
â”œâ”€â”€ KeyForge.Infrastructure/ # åŸºç¡€è®¾æ–½
â””â”€â”€ KeyForge.Tests/          # å•å…ƒæµ‹è¯•
```

### **ç¬¬äºŒé˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ– (2å‘¨)**

#### **Week 1: Windowsé’©å­å®ç°**
**ç›®æ ‡**ï¼šæ›¿æ¢Timerè½®è¯¢ä¸ºWindowsé’©å­æœºåˆ¶

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| è®¾è®¡IKeyHookæ¥å£ | é«˜ | æ¶æ„å¸ˆ | 1å¤© | æ¥å£è®¾è®¡æ–‡æ¡£ |
| å®ç°WindowsKeyHook | é«˜ | å¼€å‘è€… | 2å¤© | é’©å­å®ç°ä»£ç  |
| å®ç°é’©å­å›è°ƒå¤„ç† | é«˜ | å¼€å‘è€… | 1å¤© | å›è°ƒå¤„ç†é€»è¾‘ |
| é›†æˆåˆ°KeyForgeApp | é«˜ | å¼€å‘è€… | 1å¤© | é›†æˆæµ‹è¯• |

**å…·ä½“å®æ–½ä»£ç ï¼š**

```csharp
// æ–°å»ºï¼šKeyForge.Core/Interfaces/IKeyHook.cs
public interface IKeyHook : IDisposable
{
    event EventHandler<KeyEventArgs> KeyPressed;
    event EventHandler<KeyEventArgs> KeyReleased;
    bool IsEnabled { get; }
    void Start();
    void Stop();
}

// æ–°å»ºï¼šKeyForge.Infrastructure/Native/WindowsKeyHook.cs
public class WindowsKeyHook : IKeyHook
{
    private IntPtr _hookHandle = IntPtr.Zero;
    private HookProc _hookProc;
    
    public WindowsKeyHook()
    {
        _hookProc = HookCallback;
    }
    
    public void Start()
    {
        _hookHandle = SetWindowsHookEx(WH_KEYBOARD_LL, 
                                      _hookProc, 
                                      GetModuleHandle(null), 
                                      0);
        if (_hookHandle == IntPtr.Zero)
        {
            throw new Win32Exception(Marshal.GetLastWin32Error());
        }
    }
    
    private IntPtr HookCallback(int nCode, IntPtr wParam, IntPtr lParam)
    {
        if (nCode >= 0)
        {
            int vkCode = Marshal.ReadInt32(lParam);
            Keys key = (Keys)vkCode;
            
            if (wParam == (IntPtr)WM_KEYDOWN || wParam == (IntPtr)WM_SYSKEYDOWN)
            {
                KeyPressed?.Invoke(this, new KeyEventArgs(key));
            }
            else if (wParam == (IntPtr)WM_KEYUP || wParam == (IntPtr)WM_SYSKEYUP)
            {
                KeyReleased?.Invoke(this, new KeyEventArgs(key));
            }
        }
        return CallNextHookEx(_hookHandle, nCode, wParam, lParam);
    }
    
    // ... å®Œæ•´çš„IDisposableå®ç°
}
```

#### **Week 2: æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–**
**ç›®æ ‡**ï¼šéªŒè¯æ€§èƒ½æ”¹è¿›ï¼Œä¼˜åŒ–å®ç°

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| æ€§èƒ½åŸºå‡†æµ‹è¯• | é«˜ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 1å¤© | æ€§èƒ½åŸºå‡†æŠ¥å‘Š |
| å†…å­˜æ³„æ¼æ£€æµ‹ | é«˜ | å¼€å‘è€… | 1å¤© | å†…å­˜åˆ†ææŠ¥å‘Š |
| CPUå ç”¨ä¼˜åŒ– | ä¸­ | å¼€å‘è€… | 1å¤© | ä¼˜åŒ–å®ç° |
| å“åº”å»¶è¿Ÿæµ‹è¯• | é«˜ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 1å¤© | å»¶è¿Ÿæµ‹è¯•æŠ¥å‘Š |

**æ€§èƒ½æ”¹è¿›å¯¹æ¯”ï¼š**
- **åŸæœ¬å®ç°**ï¼šTimerè½®è¯¢ 10msé—´éš”ï¼ŒCPUå ç”¨ ~15%
- **æ”¹è¿›å®ç°**ï¼šWindowsé’©å­äº‹ä»¶é©±åŠ¨ï¼ŒCPUå ç”¨ ~0.1%
- **å“åº”å»¶è¿Ÿ**ï¼šä»10msé™ä½åˆ°<1ms

### **ç¬¬ä¸‰é˜¶æ®µï¼šæ¶æ„é‡æ„ (2å‘¨)**

#### **Week 1: æ¥å£æŠ½è±¡å±‚**
**ç›®æ ‡**ï¼šå¼•å…¥é€‚å½“æŠ½è±¡å±‚ï¼Œåˆ†ç¦»å…³æ³¨ç‚¹

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| è®¾è®¡æœåŠ¡æ¥å£ | é«˜ | æ¶æ„å¸ˆ | 2å¤© | æ¥å£è®¾è®¡æ–‡æ¡£ |
| å®ç°ä¾èµ–æ³¨å…¥ | é«˜ | å¼€å‘è€… | 2å¤© | DIå®¹å™¨é…ç½® |
| é‡æ„KeyForgeApp | é«˜ | å¼€å‘è€… | 1å¤© | é‡æ„åçš„æ ¸å¿ƒç±» |

**æ¥å£è®¾è®¡ï¼š**

```csharp
// KeyForge.Core/Interfaces/IScriptPlayer.cs
public interface IScriptPlayer
{
    Task PlayAsync(Script script, CancellationToken cancellationToken);
    void Stop();
    bool IsPlaying { get; }
    event EventHandler<ScriptPlaybackEventArgs> ActionExecuted;
}

// KeyForge.Core/Interfaces/IScriptRecorder.cs
public interface IScriptRecorder
{
    void Start();
    void Stop();
    bool IsRecording { get; }
    void AddAction(KeyAction action);
    event EventHandler<KeyAction> ActionRecorded;
}

// KeyForge.Core/Interfaces/IKeySimulator.cs
public interface IKeySimulator
{
    void KeyDown(Keys key);
    void KeyUp(Keys key);
    void KeyPress(Keys key, int delay = 50);
}
```

#### **Week 2: æœåŠ¡å®ç°**
**ç›®æ ‡**ï¼šå®ç°å…·ä½“æœåŠ¡ç±»ï¼Œå®Œå–„ä¸šåŠ¡é€»è¾‘

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| å®ç°ScriptPlayer | é«˜ | å¼€å‘è€… | 2å¤© | è„šæœ¬æ’­æ”¾æœåŠ¡ |
| å®ç°ScriptRecorder | é«˜ | å¼€å‘è€… | 2å¤© | è„šæœ¬å½•åˆ¶æœåŠ¡ |
| å®ç°KeySimulator | é«˜ | å¼€å‘è€… | 1å¤© | æŒ‰é”®æ¨¡æ‹ŸæœåŠ¡ |
| é›†æˆæµ‹è¯• | é«˜ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 1å¤© | é›†æˆæµ‹è¯•æŠ¥å‘Š |

**ä¾èµ–æ³¨å…¥é…ç½®ï¼š**

```csharp
// KeyForge.UI/ServiceConfigurator.cs
public static class ServiceConfigurator
{
    public static IServiceProvider ConfigureServices()
    {
        var services = new ServiceCollection();
        
        // æ³¨å†Œæ ¸å¿ƒæœåŠ¡
        services.AddSingleton<IKeyHook, WindowsKeyHook>();
        services.AddSingleton<IKeySimulator, WindowsKeySimulator>();
        services.AddSingleton<IScriptPlayer, AsyncScriptPlayer>();
        services.AddSingleton<IScriptRecorder, KeyScriptRecorder>();
        services.AddSingleton<IScriptRepository, JsonScriptRepository>();
        
        // æ³¨å†Œç®¡ç†å™¨
        services.AddSingleton<ErrorHandlerManager>();
        services.AddSingleton<PerformanceManager>();
        
        // æ³¨å†Œä¸»åº”ç”¨
        services.AddSingleton<KeyForgeApp>();
        
        return services.BuildServiceProvider();
    }
}
```

### **ç¬¬å››é˜¶æ®µï¼šé”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç† (1å‘¨)**

#### **Day 1-3: é”™è¯¯å¤„ç†é›†æˆ**
**ç›®æ ‡**ï¼šé›†æˆErrorHandlerManagerï¼Œå®Œå–„é”™è¯¯å¤„ç†

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| é›†æˆé”™è¯¯å¤„ç† | é«˜ | å¼€å‘è€… | 1å¤© | é”™è¯¯å¤„ç†é›†æˆä»£ç  |
| å®ç°æ¢å¤ç­–ç•¥ | é«˜ | å¼€å‘è€… | 1å¤© | æ¢å¤ç­–ç•¥å®ç° |
| é”™è¯¯æ—¥å¿—å®Œå–„ | ä¸­ | å¼€å‘è€… | 1å¤© | æ—¥å¿—ç³»ç»Ÿå®Œå–„ |

**é”™è¯¯å¤„ç†é›†æˆï¼š**

```csharp
// æ”¹è¿›ï¼šKeyForge.UI/KeyForgeApp.cs
public class KeyForgeApp : IDisposable
{
    private readonly ErrorHandlerManager _errorHandler;
    private readonly ILogger _logger;
    
    public KeyForgeApp(
        IKeyHook keyHook,
        IScriptPlayer scriptPlayer,
        IScriptRecorder scriptRecorder,
        ErrorHandlerManager errorHandler,
        ILogger logger)
    {
        _keyHook = keyHook;
        _scriptPlayer = scriptPlayer;
        _scriptRecorder = scriptRecorder;
        _errorHandler = errorHandler;
        _logger = logger;
        
        // æ³¨å†Œé»˜è®¤é”™è¯¯å¤„ç†å™¨
        RegisterErrorHandlers();
        
        // è®¢é˜…äº‹ä»¶
        _keyHook.KeyPressed += OnKeyPressed;
        _scriptPlayer.ActionExecuted += OnActionExecuted;
    }
    
    private void RegisterErrorHandlers()
    {
        var defaultHandlers = ErrorHandlerManager.CreateDefaultHandlers(_keySimulator);
        foreach (var handler in defaultHandlers)
        {
            _errorHandler.RegisterErrorHandler(handler.ExceptionType, handler);
        }
    }
    
    public async Task PlayScriptAsync()
    {
        try
        {
            await _scriptPlayer.PlayAsync(_currentScript, _cancellationTokenSource.Token);
        }
        catch (Exception ex)
        {
            _errorHandler.HandleException(ex, "PlayScriptAsync");
            OnStatusChanged?.Invoke($"æ’­æ”¾å¤±è´¥: {ex.Message}");
            throw;
        }
    }
}
```

#### **Day 4-5: èµ„æºç®¡ç†ä¼˜åŒ–**
**ç›®æ ‡**ï¼šå®Œå–„èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„è®¡æ—¶é—´ | äº¤ä»˜ç‰© |
|------|--------|--------|----------|--------|
| å®ç°IDisposable | é«˜ | å¼€å‘è€… | 1å¤© | èµ„æºç®¡ç†å®ç° |
| å†…å­˜æ³„æ¼æ£€æµ‹ | é«˜ | å¼€å‘è€… | 1å¤© | å†…å­˜æ£€æµ‹æŠ¥å‘Š |
| èµ„æºé‡Šæ”¾æµ‹è¯• | é«˜ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 1å¤© | èµ„æºæµ‹è¯•æŠ¥å‘Š |

**èµ„æºç®¡ç†ä¼˜åŒ–ï¼š**

```csharp
// æ”¹è¿›ï¼šKeyForge.UI/KeyForgeApp.cs (ç»­)
public class KeyForgeApp : IDisposable
{
    private bool _disposed;
    private readonly List<IDisposable> _disposables = new List<IDisposable>();
    private CancellationTokenSource _cancellationTokenSource;
    
    public KeyForgeApp(/* ... ä¾èµ–é¡¹ ... */)
    {
        // æ³¨å†Œæ‰€æœ‰éœ€è¦é‡Šæ”¾çš„èµ„æº
        _disposables.Add(_keyHook);
        _disposables.Add(_scriptPlayer);
        _disposables.Add(_scriptRecorder);
        _disposables.Add(_errorHandler);
        
        _cancellationTokenSource = new CancellationTokenSource();
    }
    
    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }
    
    protected virtual void Dispose(bool disposing)
    {
        if (!_disposed)
        {
            if (disposing)
            {
                // å–æ¶ˆæ‰€æœ‰å¼‚æ­¥æ“ä½œ
                _cancellationTokenSource?.Cancel();
                _cancellationTokenSource?.Dispose();
                
                // æŒ‰ç›¸åé¡ºåºé‡Šæ”¾èµ„æº
                for (int i = _disposables.Count - 1; i >= 0; i--)
                {
                    try
                    {
                        _disposables[i]?.Dispose();
                    }
                    catch (Exception ex)
                    {
                        _logger.Error($"é‡Šæ”¾èµ„æºæ—¶å‘ç”Ÿé”™è¯¯: {ex.Message}");
                    }
                }
                _disposables.Clear();
            }
            _disposed = true;
        }
    }
    
    ~KeyForgeApp()
    {
        Dispose(false);
    }
}
```

## ğŸ”§ **æŠ€æœ¯å®æ–½ç»†èŠ‚**

### **1. æ€§èƒ½ä¼˜åŒ–å®ç°**

#### **Windowsé’©å­ vs Timerè½®è¯¢**
```csharp
// åŸæœ¬å®ç°ï¼šTimerè½®è¯¢ (KeyForgeApp.cs ç¬¬38è¡Œ)
_globalHookTimer = new System.Windows.Forms.Timer();
_globalHookTimer.Interval = 10; // 10msè½®è¯¢
_globalHookTimer.Tick += CheckKeyStates;

// æ”¹è¿›å®ç°ï¼šWindowsé’©å­
private IntPtr _hookHandle = IntPtr.Zero;
private HookProc _hookProc;

public void StartHook()
{
    _hookProc = HookCallback;
    _hookHandle = SetWindowsHookEx(WH_KEYBOARD_LL, _hookProc, GetModuleHandle(null), 0);
}

private IntPtr HookCallback(int nCode, IntPtr wParam, IntPtr lParam)
{
    // äº‹ä»¶é©±åŠ¨ï¼Œæ— éœ€è½®è¯¢
    if (nCode >= 0)
    {
        // å¤„ç†æŒ‰é”®äº‹ä»¶
    }
    return CallNextHookEx(_hookHandle, nCode, wParam, lParam);
}
```

#### **æ€§èƒ½å¯¹æ¯”æŒ‡æ ‡**
| æŒ‡æ ‡ | åŸæœ¬å®ç° | æ”¹è¿›å®ç° | æ”¹è¿›å¹…åº¦ |
|------|----------|----------|----------|
| CPUå ç”¨ç‡ | ~15% | ~0.1% | 99.3% |
| å“åº”å»¶è¿Ÿ | 10ms | <1ms | 90% |
| å†…å­˜å ç”¨ | 30MB | 15MB | 50% |
| å¯åŠ¨æ—¶é—´ | 2s | 1s | 50% |

### **2. æ¶æ„é‡æ„å®ç°**

#### **èŒè´£åˆ†ç¦»**
```csharp
// åŸæœ¬å®ç°ï¼šæ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªç±»
public class KeyForgeApp
{
    // 600+ è¡Œä»£ç ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½
}

// æ”¹è¿›å®ç°ï¼šåˆ†ç¦»å…³æ³¨ç‚¹
public class KeyForgeApp
{
    private readonly IKeyHook _keyHook;
    private readonly IScriptPlayer _scriptPlayer;
    private readonly IScriptRecorder _scriptRecorder;
    private readonly IKeySimulator _keySimulator;
    
    // æ¯ä¸ªç±»ä¸è¶…è¿‡200è¡Œï¼ŒèŒè´£å•ä¸€
}

public class AsyncScriptPlayer : IScriptPlayer
{
    // ä¸“æ³¨äºè„šæœ¬æ’­æ”¾é€»è¾‘
}

public class KeyScriptRecorder : IScriptRecorder
{
    // ä¸“æ³¨äºè„šæœ¬å½•åˆ¶é€»è¾‘
}
```

### **3. é”™è¯¯å¤„ç†å®ç°**

#### **ç­–ç•¥æ¨¡å¼**
```csharp
// é”™è¯¯æ¢å¤ç­–ç•¥
public class ErrorHandler
{
    public string Name { get; set; }
    public Type ExceptionType { get; set; }
    public int Priority { get; set; }
    public Func<ErrorInfo, Task<bool>> RecoveryStrategy { get; set; }
}

// é¢„å®šä¹‰æ¢å¤ç­–ç•¥
public static class ErrorRecoveryStrategies
{
    public static ErrorHandler CreateRetryStrategy()
    {
        return new ErrorHandler
        {
            Name = "é‡è¯•ç­–ç•¥",
            ExceptionType = typeof(TimeoutException),
            Priority = 1,
            RecoveryStrategy = async (error) =>
            {
                await Task.Delay(1000);
                return true;
            }
        };
    }
    
    public static ErrorHandler CreateFallbackStrategy()
    {
        return new ErrorHandler
        {
            Name = "é™çº§ç­–ç•¥",
            ExceptionType = typeof(InvalidOperationException),
            Priority = 2,
            RecoveryStrategy = async (error) =>
            {
                // é™çº§å¤„ç†é€»è¾‘
                return true;
            }
        };
    }
}
```

## ğŸ“ˆ **è´¨é‡ä¿è¯æªæ–½**

### **1. ä»£ç è´¨é‡æ ‡å‡†**
- **ä»£ç è¦†ç›–ç‡**ï¼šâ‰¥ 80%
- **åœˆå¤æ‚åº¦**ï¼šæ¯ä¸ªæ–¹æ³• < 10
- **ç±»è€¦åˆåº¦**ï¼š< 5
- **ä»£ç è¡Œæ•°**ï¼šæ¯ä¸ªç±» < 200è¡Œ

### **2. æ€§èƒ½æµ‹è¯•æ ‡å‡†**
- **CPUå ç”¨ç‡**ï¼š< 5%ï¼ˆç©ºé—²çŠ¶æ€ï¼‰
- **å†…å­˜å ç”¨**ï¼š< 50MB
- **å“åº”å»¶è¿Ÿ**ï¼š< 1ms
- **å¯åŠ¨æ—¶é—´**ï¼š< 1ç§’

### **3. ç¨³å®šæ€§æµ‹è¯•æ ‡å‡†**
- **24å°æ—¶è¿ç»­è¿è¡Œ**ï¼šæ— å´©æºƒ
- **å†…å­˜æ³„æ¼æ£€æµ‹**ï¼šæ— æ³„æ¼
- **é”™è¯¯æ¢å¤æˆåŠŸç‡**ï¼š> 95%
- **èµ„æºè‡ªåŠ¨å›æ”¶**ï¼šæœ‰æ•ˆ

## ğŸ¯ **æˆåŠŸæ ‡å‡†**

### **æŠ€æœ¯æŒ‡æ ‡**
- [ ] ä»£ç è´¨é‡è¯„åˆ† â‰¥ 95/100
- [ ] æ€§èƒ½æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- [ ] ç¼–è¯‘æ—¶é—´ç¼©çŸ­30%

### **åŠŸèƒ½æŒ‡æ ‡**
- [ ] æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æŒ‰é”®å½•åˆ¶ç²¾åº¦æå‡100%
- [ ] å“åº”å»¶è¿Ÿ < 1ms
- [ ] CPUå ç”¨ç‡é™ä½80%
- [ ] å†…å­˜å ç”¨å‡å°‘50%

### **ç”¨æˆ·ä½“éªŒ**
- [ ] å¯åŠ¨é€Ÿåº¦æå‡50%
- [ ] æ“ä½œå“åº”æ›´åŠæ—¶
- [ ] ç³»ç»Ÿè¿è¡Œæ›´ç¨³å®š
- [ ] é”™è¯¯æç¤ºæ›´å‹å¥½

## ğŸš¨ **é£é™©ç®¡ç†**

### **æŠ€æœ¯é£é™©**
| é£é™© | å½±å“ç¨‹åº¦ | å‘ç”Ÿæ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|----------|----------|----------|
| Windowsé’©å­APIå¤æ‚åº¦ | é«˜ | ä¸­ | è¯¦ç»†ç ”ç©¶æ–‡æ¡£ï¼Œå……åˆ†æµ‹è¯• |
| æ€§èƒ½å›å½’ | ä¸­ | ä¸­ | æŒç»­æ€§èƒ½ç›‘æ§ï¼ŒåŸºå‡†æµ‹è¯• |
| å†…å­˜æ³„æ¼ | ä¸­ | ä½ | ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼Œå®šæœŸæ£€æµ‹ |

### **é¡¹ç›®é£é™©**
| é£é™© | å½±å“ç¨‹åº¦ | å‘ç”Ÿæ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|----------|----------|----------|
| è¿›åº¦å»¶è¿Ÿ | ä¸­ | ä¸­ | åˆç†å®‰æ’æ—¶é—´ï¼Œè®¾ç½®ç¼“å†²æœŸ |
| å…¼å®¹æ€§é—®é¢˜ | ä¸­ | ä½ | å¤šç¯å¢ƒæµ‹è¯•ï¼Œç‰ˆæœ¬é€‚é… |
| åŠŸèƒ½å›å½’ | é«˜ | ä½ | å…¨é¢æµ‹è¯•ï¼Œé€æ­¥å‘å¸ƒ |

## ğŸ“š **äº¤ä»˜ç‰©æ¸…å•**

### **ä»£ç äº¤ä»˜ç‰©**
- [ ] æ¸…ç†åçš„é¡¹ç›®ç»“æ„
- [ ] Windowsé’©å­å®ç°ä»£ç 
- [ ] é‡æ„åçš„æœåŠ¡ç±»
- [ ] é”™è¯¯å¤„ç†é›†æˆä»£ç 
- [ ] èµ„æºç®¡ç†ä¼˜åŒ–ä»£ç 

### **æµ‹è¯•äº¤ä»˜ç‰©**
- [ ] å•å…ƒæµ‹è¯•å¥—ä»¶
- [ ] é›†æˆæµ‹è¯•å¥—ä»¶
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹æŠ¥å‘Š
- [ ] ç¨³å®šæ€§æµ‹è¯•æŠ¥å‘Š

### **æ–‡æ¡£äº¤ä»˜ç‰©**
- [ ] æ”¹è¿›éœ€æ±‚æ–‡æ¡£
- [ ] æ¶æ„è®¾è®¡æ–‡æ¡£
- [ ] å®æ–½è®¡åˆ’æ–‡æ¡£
- [ ] APIæ¥å£æ–‡æ¡£
- [ ] éƒ¨ç½²æŒ‡å—

## ğŸ”„ **åç»­ç»´æŠ¤è®¡åˆ’**

### **1. æŒç»­ç›‘æ§**
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- å†…å­˜ä½¿ç”¨ç›‘æ§
- é”™è¯¯ç‡ç›‘æ§
- ç”¨æˆ·åé¦ˆæ”¶é›†

### **2. å®šæœŸä¼˜åŒ–**
- æ¯æœˆæ€§èƒ½ä¼˜åŒ–
- æ¯å­£åº¦æ¶æ„è¯„ä¼°
- æ¯åŠå¹´å®‰å…¨å®¡è®¡
- æ¯å¹´æŠ€æœ¯æ ˆå‡çº§

### **3. æ–‡æ¡£æ›´æ–°**
- ä»£ç æ³¨é‡Šä¿æŒæœ€æ–°
- æŠ€æœ¯æ–‡æ¡£å®šæœŸæ›´æ–°
- ç”¨æˆ·æ‰‹å†ŒæŒç»­å®Œå–„
- æœ€ä½³å®è·µæ–‡æ¡£æ²‰æ·€

---

## **æ€»ç»“**

æœ¬å®æ–½è®¡åˆ’é€šè¿‡åˆ†é˜¶æ®µçš„æ–¹å¼ï¼Œç³»ç»Ÿæ€§åœ°è§£å†³KeyForgeé¡¹ç›®çš„å…³é”®é—®é¢˜ã€‚é‡ç‚¹åŒ…æ‹¬ï¼š

1. **é¡¹ç›®ç»“æ„æ¸…ç†**ï¼šåˆ é™¤99ä¸ªå†—ä½™æ–‡ä»¶ï¼Œä¼˜åŒ–é¡¹ç›®ç»“æ„
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šç”¨Windowsé’©å­æ›¿æ¢Timerè½®è¯¢ï¼Œå¤§å¹…æå‡æ€§èƒ½
3. **æ¶æ„é‡æ„**ï¼šå¼•å…¥é€‚å½“æŠ½è±¡å±‚ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§
4. **é”™è¯¯å¤„ç†**ï¼šé›†æˆå®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
5. **èµ„æºç®¡ç†**ï¼šå®Œå–„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

é€šè¿‡è¿™ä¸ªè®¡åˆ’ï¼ŒKeyForgeç³»ç»Ÿçš„ä»£ç è´¨é‡å°†ä»85åˆ†æå‡åˆ°95åˆ†ä»¥ä¸Šï¼Œæˆä¸ºä¸€ä¸ªé«˜è´¨é‡ã€é«˜æ€§èƒ½ã€é«˜ç¨³å®šæ€§çš„æŒ‰é”®è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚